<h2>Experimenter View</h2>
<h3>
  Welcome to the experimenter view! Here you can select the number of particpants in each stage of
  the experiment and mediate the chat.
</h3>
<div>
  <p>Number of participants ({{ participants().length }})</p>
  @for (p of participants(); track p.userId) {
    <li>
      id: {{ p.userId }}<br />
      Name: {{ p.profile.name }}<br />
      Preffered pronouns: {{ p.profile.pronouns }}<br />
      Avatar:
      @if (p.profile.avatarUrl) {
        <img [src]="p.profile.avatarUrl" alt="avatar" />
      } @else {
        no avatar set
      }
      <br />
      Working on stage: {{ p.workingOnStageName }}<br />
      <a
        [routerLink]="['/participant', this.experimentName(), p.userId]"
        [queryParams]="{ stage: p.workingOnStageName }"
        >Go to participant view</a
      >
      <!-- <div>
          Participants:
          @for (p of Object.values(e.participants); track p.) {}
        </div> -->
    </li>
  }
</div>

<h3>Experiment stages:</h3>

@for (stageState of stageStates(); track stageState.name) {
  <div>
    {{ stageState.name }}: {{ stageState.participants.length }}

    @if (stageState.kind === STAGE_KIND_CHAT) {
      <mat-accordion>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title> Current state of the Chat Discussion </mat-panel-title>
            <mat-panel-description>
              You can interact directly with the chat here.
            </mat-panel-description>
          </mat-expansion-panel-header>
          <app-mediator-chat
            [experiment]="experimentName"
            [participants]="this.participants"
            [chatRoomName]="stageState.name"
          ></app-mediator-chat>
        </mat-expansion-panel>
      </mat-accordion>
    }
  </div>
}
